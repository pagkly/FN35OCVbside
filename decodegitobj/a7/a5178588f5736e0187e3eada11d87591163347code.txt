b'blob 8394\x00/**\n * Handle the display of all the given achievements\n *\n * @param achJsonArray The array of Achievements to handle\n */\nfunction handleAchievements( achJsonArray )\n{\n\n  if ( achJsonArray === undefined || achJsonArray.length < 1 )\n    return;\n\n  Effect.Notify = function( element )\n  {\n    element = $( element );\n    return new Effect.Appear( element,\n    {\n      afterFinishInternal : function( effect )\n      {\n        new Effect.Fade( effect.element,\n        {\n          delay : 8.0\n        } );\n      }\n    } );\n  };\n\n  var message = \'\';\n\n  if ( achJsonArray.length == 1 )\n    message = achJsonArray[ 0 ].newAchMsg;\n  else\n    message = achJsonArray[ 0 ].newAchMsgs;\n\n  var insertionPoint = $( \'breadcrumbs\' );\n  var pageWidth = insertionPoint.getWidth();\n  var clickTarget = window.location.protocol + \'//\' + window.location.host + \'/webapps/achievements/studentViewAchievements.form?course_id=\' + achJsonArray[ 0 ].courseId;\n  var divWidth = Math.floor( pageWidth / 3 );\n  if ( divWidth > 500 )\n    divWidth = 500;\n  var position = Math.floor( ( pageWidth / 2 ) - ( divWidth / 2 ) );\n  //Div within an <a> tag is now valid: http://dev.w3.org/html5/markup/a.html#a-changes\n  var notDiv = \'<a href="\' + clickTarget + \'">\' +\n                 \'<div id="achNotificationDiv" style="display:none; \' + //display:none CANNOT move to CSS file for Scriptaculous effects to work\n                   \'width: \' + divWidth +\'px;  \' +\n                   \'left: \' + position + \'px; ">\' +\n                   \'<div>\' + message + \'</div>\' +\n                 \'</div>\' +\n               \'</a>\';\n\n  insertionPoint.insert(\n  {\n    before : notDiv\n  } );\n  new Effect.Notify( \'achNotificationDiv\' );\n}\n\nfunction changeAchCardFilter( selectedFilter ) {\n\n  var selectedSpan = $(selectedFilter);\n\n  $$(\'.selectedFilter\').invoke(\'removeClassName\', \'selectedFilter\');\n  selectedSpan.addClassName(\'selectedFilter\');\n\n  if ( selectedFilter === \'allSpan\' ) {\n    $$(\'div.achievementCardDiv.achievementCardEarned\').invoke(\'appear\');\n    $$(\'div.achievementCardDiv.achievementCardUnearned\').invoke(\'appear\', {from: 0, to: 0.5});\n  } else if ( selectedFilter === \'earnedSpan\' ) {\n    $$(\'div.achievementCardDiv.achievementCardUnearned\').invoke(\'fade\', {from: 0.5, to: 0});\n    $$(\'div.achievementCardDiv.achievementCardEarned\').invoke(\'appear\');\n  } else if ( selectedFilter === \'unearnedSpan\' ) {\n    $$(\'div.achievementCardDiv.achievementCardEarned\').invoke(\'fade\');\n    $$(\'div.achievementCardDiv.achievementCardUnearned\').invoke(\'appear\', {from: 0, to: 0.5});\n  }\n  return false;\n}\n\nfunction printCertificate( certKey, courseId, achId ) {\n\tvar url = \'previewCertificate.do?course_id=\' + courseId + \'&cert_key=\' + certKey + \'&action=print\';\n\tif (achId !== null || achId !== undefined) {\n\t\turl = \'previewCertificate.do?course_id=\' + courseId + \'&ach_id=\' + achId + \'&cert_key=\' + certKey + \'&action=print\';\n\t}\n\n  remote = window.open(url, \'print_certificate\', \'height=600px,width=800px\');\n  return false;\n}\n\nfunction amILoaded() {\n  return true;\n}\n\n//Copy-paste from bb-alerts/js/nautilus_stream.js\nfunction onDismissEvent( event, actorIdStr, providerId, sequenceId )\n{\n  var e = event || window.event; // IE does not capture the event\n  if( e && e.type == \'click\')\n  {\n    Event.stop(e);\n  }\n  NautilusViewService.removeRecipient( actorIdStr, {\n     errorHandler: function() {\n       // TODO: Get a better message\n       alert("Error removing notification! " );\n     },\n     callback: function(item) {\n       //let model remove\n       stream.removeSingleEntry( "alerts", providerId + sequenceId );\n     }.bind(this) });\n  page.ContextMenu.closeAllContextMenus();\n}\n\n//Load More Lightbox\n// Requires the following page elements:\n//\n//<div id=\'tableDiv\'></div>\n//<div id=\'buttonDiv\' style="text-align: center;"></div>\n//<span id=\'hiddenSpan\' style="display: none;"></span>\n\nfunction initializeTable() {\n  //Builds the initial table\n\n  var data = resetData();\n\n  if ( data.length === 0 ) {\n    //Insert "none" message into Div\n    var noneText = JS_RESOURCES[\'bb.instructorView.lightbox.emptyMsg\'];\n    var textNode = document.createTextNode( noneText );\n\n    $(\'tableDiv\').setStyle({\n      textAlign:\'center\'\n    });\n    $(\'tableDiv\').addClassName(\'noItems\');\n    $(\'tableDiv\').addClassName(\'$emptyMsgCustomClass\');\n\n    $(\'tableDiv\').appendChild(textNode);\n\n  } else {\n\n    var table = document.createElement("table");\n    table.className = "inventory sortable";\n\n    //Create Header Row\n    var thead = document.createElement("thead");\n    var tr1 = document.createElement("tr");\n    var th = document.createElement("th");\n    var localizedStr = JS_RESOURCES[\'bb.instructorView.lightbox.name\'];\n    var headerText = document.createTextNode(localizedStr);\n    th.appendChild(headerText);\n    tr1.appendChild(th);\n\n    th = document.createElement("th");\n    localizedStr = JS_RESOURCES[\'bb.instructorView.lightbox.dateRec\'];\n    headerText = document.createTextNode(localizedStr);\n    th.appendChild(headerText);\n    tr1.appendChild(th);\n\n    thead.appendChild(tr1);\n    table.appendChild(thead);\n\n    //Create Table body\n    var tbody = document.createElement("tbody");\n    insertBodyRows( tbody, data );\n    table.appendChild(tbody);\n\n    $(\'tableDiv\').update();\n    $(\'tableDiv\').appendChild(table);\n  }\n}\n\nfunction loadMore() {\n  //Inserts new values into the existing table\n\n  var data = resetData();\n  var body = document.getElementById("tableDiv").getElementsByTagName("tbody")[0];\n  insertBodyRows( body, data );\n}\n\nfunction resetData() {\n\n  var data = getNextPage();\n\n  if ( data.length > 0 ) {\n    document.getElementById("hiddenSpan").innerHTML = data[data.length-1].id;\n  }\n\n  var loadMoreBtn = document.getElementById("loadMoreBtn");\n  if ( data.length === 25 && loadMoreBtn === null ) {\n    //Insert Load More button\n    //The button will appear if the result set is a multiple of 25, but clicking it should result in the removal of the button\n    //    since the next page will contain 0 elements\n    loadMoreBtn = document.createElement(\'button\');\n    loadMoreBtn.id = \'loadMoreBtn\';\n    if ( !Prototype.Browser.IE ) {\n      loadMoreBtn.type = \'button\';\n    }\n    loadMoreBtn.innerHTML = JS_RESOURCES[\'bb.instructorView.lightbox.loadMore\'];\n    loadMoreBtn.onclick = function() {\n      loadMore();\n      return false;\n    };\n\n    document.getElementById("buttonDiv").appendChild(loadMoreBtn);\n  } else if ( data.length !== 25 && loadMoreBtn !== null ){\n    //Remove Load More button\n    $(\'loadMoreBtn\').remove();\n  }\n  return data;\n}\n\nfunction insertBodyRows( body, data ) {\n\n  var courseId = JS_RESOURCES[\'bb.instructorView.lightbox.courseId\'];\n\n  for (var index = 0; index < data.length; ++index) {\n     var recipient = data[index];\n     //Create new row\n     var tr2 = document.createElement("tr");\n\n     //First Column\n     var td = document.createElement("td");\n     var cellText = recipient.userGivenName + " " + recipient.userFamilyName;\n     var textNode = document.createTextNode( cellText );\n\n     var a = document.createElement(\'a\');\n     if ( recipient.avatarImgLocation !== null ) {\n       var img = document.createElement(\'img\');\n       img.src = recipient.avatarImgLocation;\n       img.style.maxHeight = \'75px\';\n       img.style.maxWidth = \'75px\';\n       a.appendChild(img);\n     }\n     a.appendChild(textNode);\n\n     a.title = cellText;\n     a.href = \'studentViewAchievements.form?course_id=\' + courseId + \'&user_id=\' + recipient.userId;\n\n     td.appendChild(a);\n     tr2.appendChild(td);\n\n     //Second Column\n     var dateColumn = document.createTextNode(recipient.announcedTime);\n\n     var td2 = document.createElement("td");\n     td2.appendChild(dateColumn);\n     tr2.appendChild(td2);\n\n     body.appendChild(tr2);\n  }\n\n}\n\nfunction getNextPage() {\n  //Get the data to insert on the next page of the table\n  var retVal = \'\';\n  var contentId = JS_RESOURCES[\'bb.instructorView.lightbox.contentId\'];\n  new Ajax.Request(\'getRecipientList.form\', {\n                method: \'get\',\n                asynchronous: false,\n                parameters: {content_id: contentId, lastVOId: document.getElementById(\'hiddenSpan\').innerHTML },\n                onSuccess: function(transport) {\n                  retVal = transport.responseText.evalJSON(true);\n                },\n                onFailure: function(transport) {\n                  alert(transport);\n                }\n   });\n  return retVal;\n}\n'